<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<!-- Created on January 13, 2015 by texi2html 1.82
texi2html was written by: 
            Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people.
Send bugs and suggestions to <texi2html-bug@nongnu.org>
-->
<head>
<title>vasm manual: 22. Trillek TR3200 cpu module</title>

<meta name="description" content="vasm manual: 22. Trillek TR3200 cpu module">
<meta name="keywords" content="vasm manual: 22. Trillek TR3200 cpu module">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.82">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.roman {font-family:serif; font-weight:normal;}
span.sansserif {font-family:sans-serif; font-weight:normal;}
ul.toc {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="vasm_20.html#Jaguar-RISC-cpu-module" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="vasm_22.html#Interface" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="vasm_0.html#General-9" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="vasm_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[Index]</td>
<td valign="middle" align="left">[<a href="vasm_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>

<hr size="2">
<a name="Trillek-TR3200-cpu-module"></a>
<a name="Trillek-TR3200-cpu-module-1"></a>
<h1 class="chapter">22. Trillek TR3200 cpu module</h1>
<p>This chapter documents the Backend for the TR3200 cpu.
</p>
<hr size="6">
<a name="Legal-11"></a>
<h2 class="section">22.1 Legal</h2>

<p>    This module is written in 2014 by Luis Panadero Guarde&ntilde;o. Based on test CPU
    module written by Volker Barthelmann in 2002.
</p>
<p>    This archive may be redistributed without modifications and used
    for non-commercial purposes.
</p>
<p>    Distributing modified versions and commercial usage needs my written
    consent.
</p>
<p>    Certain modules may fall under additional copyrights.
</p>
<hr size="6">
<a name="General-13"></a>
<h2 class="section">22.2 General</h2>

<p>This backend accepts TR3200 instructions as described in the
<a href="https://github.com/trillek-team/trillek-computer">TR3200 specification</a>
</p>
<p>The target address type is 32 bits.
</p>
<p>Default alignment for sections is 4 bytes. Instructions alignment is 4 bytes.
Data is aligned to its natural alignment by default, i.e. 2 byte wide data
alignment is 2 bytes and 4 byte wide data alignment is 4 byte.
</p>
<p>The backend uses TR3200 syntax! This means the left operands are always the
destination and the right operand is the source (except for single operand
instructions). Register names have to be prefixed by a &rsquo;<code>%</code>&rsquo;
(<code>%bp</code>, <code>%r0</code>, etc.)
This means that it should accept WaveAsm assembly files if oldstyle syntax module
is being used. The instructions are lowercase, &lsquo;<samp>-dotdir</samp>&rsquo; option is being used
and directives are not in the first column.
</p>
<hr size="6">
<a name="Extensions-7"></a>
<h2 class="section">22.3 Extensions</h2>

<p>Predefined register symbols in this backend:
</p>
<ul class="toc">
<li>- register by number: <code>r0 r1 r2 r3 r4 r5 r6 r7 r8 r9 r10 r11 r12 r13 r14 r15</code>
</li><li>- special registers by name: <code>bp sp y ia flags</code>
</li></ul>

<hr size="6">
<a name="Known-Problems-11"></a>
<h2 class="section">22.4 Known Problems</h2>

<p>    This module need to be fully checked, but has been tested building a full
    program that could be found here : <a href="https://github.com/Zardoz89/trillek-firmware">https://github.com/Zardoz89/trillek-firmware</a>
</p>
<hr size="6">
<a name="Error-Messages-5"></a>
<h2 class="section">22.5 Error Messages</h2>

<p>This module has the following error messages:
</p>
<ul class="toc">
<li>- 2001: illegal operand
</li><li>- 2002: illegal qualifier &lt;%s&gt;
</li><li>- 2003: data size not supported
</li></ul>

<hr size="6">
<a name="Example"></a>
<h2 class="section">22.6 Example</h2>

<p>It follows a little example to illustrate TR3200 assembly using
the oldstyle syntax module (option &lsquo;<samp>-dotdir</samp>&rsquo; required):
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">const   .equ 0xBEBACAFE           ; A constant
an_addr .equ 0x100                ; Other constant

; ROM code
      .org 0x100000
      .text
_start                            ; Label with or without a ending &quot;:&quot;
      mov %sp, 0x1000             ; Set the initial stack

      mov %r0, 0
      mov %r1, 0xA5
      mov %r2, 0
      storeb %r0, an_addr, %r1

      add %r0, %r2, %bp
      add %r0, %r2, 0
      add %r0, %r0, 10
      add %r0, %r0, 10h
      add %r0, %r0, 0x100010
      add %r0, %r0, (256 + 100)   ; vasm parses math expressions

      mov %r2, 0
      mov %r3, 0x10200

      loadb %r6, 0x100200
      loadb %r1, %r2, 0x100200
      loadb %r1, %r2, %r3
      loadb %r4, var1

      push %r0
      .repeat 2                 ; directives to repeat stuff!
      push const
      .endrepeat

      .repeat 2
      pop %r5
      .endrepeat
      pop %r0

      rcall foo                 ; Relative call/jump!
      sleep

foo:      ; Subrutine
      ifneq %r5, 0
        mul %r5, %r5, 2
      sub %r5, %r5, 1

      ret

; ROM data
      .org 0x100500
var1  .db 0x20                  ; A byte size variable
      .even                     ; Enforce to align to even address
var3  .dw 0x1020                ; A word size variable
var4  .dd 0x0A0B0C20            ; A double word size variable
str1  .asciiz &quot;Hello world!&quot;    ; ASCII string with null termination
str2  .string &quot;Hello world!&quot;    ; ASCII string with null termination
      .fill 5, 0xFF             ; Fill 5 bytes with 0xFF
      .reserve 5                ; Reserves space for 5 byte

</pre></td></tr></table>

<hr size="6">
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Trillek-TR3200-cpu-module" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="vasm_22.html#Interface" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="vasm_0.html#General-9" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="vasm_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[Index]</td>
<td valign="middle" align="left">[<a href="vasm_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<p>
 <font size="-1">
  This document was generated by <em>Luis Panadero Guarde√±o</em> on <em>January 13, 2015</em> using <a href="http://www.nongnu.org/texi2html/"><em>texi2html 1.82</em></a>.
 </font>
 <br>

</p>
</body>
</html>
