<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<!-- Created on January 13, 2015 by texi2html 1.82
texi2html was written by: 
            Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people.
Send bugs and suggestions to <texi2html-bug@nongnu.org>
-->
<head>
<title>vasm manual: 17. ARM cpu module</title>

<meta name="description" content="vasm manual: 17. ARM cpu module">
<meta name="keywords" content="vasm manual: 17. ARM cpu module">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.82">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.roman {font-family:serif; font-weight:normal;}
span.sansserif {font-family:sans-serif; font-weight:normal;}
ul.toc {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="vasm_15.html#g_t6502-cpu-module" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="vasm_17.html#g_t80x86-cpu-module" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="vasm_0.html#General-9" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="vasm_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[Index]</td>
<td valign="middle" align="left">[<a href="vasm_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>

<hr size="2">
<a name="ARM-cpu-module"></a>
<a name="ARM-cpu-module-1"></a>
<h1 class="chapter">17. ARM cpu module</h1>
<p>This chapter documents the backend for the Advanced RISC Machine (ARM)
microprocessor family.
</p>
<hr size="6">
<a name="Legal-10"></a>
<h2 class="section">17.1 Legal</h2>

<p>    This module is copyright in 2004,2006 by Frank Wille.
</p>
<p>    This archive may be redistributed without modifications and used
    for non-commercial purposes.
</p>
<p>    Distributing modified versions and commercial usage needs my written
    consent.
</p>
<p>    Certain modules may fall under additional copyrights.
</p>

<hr size="6">
<a name="Additional-options-for-this-module-8"></a>
<h2 class="section">17.2 Additional options for this module</h2>

<p>This module provides the following additional options:
</p>
<dl compact="compact">
<dt> &lsquo;<samp>-a2</samp>&rsquo;</dt>
<dd><p>        Generate code compatible with ARM V2 architecture.
</p>
    </dd>
<dt> &lsquo;<samp>-a3</samp>&rsquo;</dt>
<dd><p>        Generate code compatible with ARM V3 architecture.
</p>
    </dd>
<dt> &lsquo;<samp>-a3m</samp>&rsquo;</dt>
<dd><p>        Generate code compatible with ARM V3m architecture.
</p>
    </dd>
<dt> &lsquo;<samp>-a4</samp>&rsquo;</dt>
<dd><p>        Generate code compatible with ARM V4 architecture.
</p>
    </dd>
<dt> &lsquo;<samp>-a4t</samp>&rsquo;</dt>
<dd><p>        Generate code compatible with ARM V4t architecture.
</p>
    </dd>
<dt> &lsquo;<samp>-big</samp>&rsquo;</dt>
<dd><p>        Output big-endian code and data.
</p>
    </dd>
<dt> &lsquo;<samp>-little</samp>&rsquo;</dt>
<dd><p>        Output little-endian code and data (default).
</p>
    </dd>
<dt> &lsquo;<samp>-m2</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM2 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m250</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM250 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m3</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM3 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m6</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM6 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m600</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM600 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m610</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM610 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m7</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM7 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m710</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM710 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m7500</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM7500 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m7d</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM7d CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m7di</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM7di CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m7dm</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM7dm CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m7dmi</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM7dmi CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m7tdmi</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM7tdmi CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m8</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM8 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m810</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM810 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m9</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM9 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m9</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM9 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m920</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM920 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m920t</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM920t CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-m9tdmi</samp>&rsquo;</dt>
<dd><p>        Generate code for the ARM9tdmi CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-msa1</samp>&rsquo;</dt>
<dd><p>        Generate code for the SA1 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-mstrongarm</samp>&rsquo;</dt>
<dd><p>        Generate code for the STRONGARM CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-mstrongarm110</samp>&rsquo;</dt>
<dd><p>        Generate code for the STRONGARM110 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-mstrongarm1100</samp>&rsquo;</dt>
<dd><p>        Generate code for the STRONGARM1100 CPU.
</p>
    </dd>
<dt> &lsquo;<samp>-opt-adr</samp>&rsquo;</dt>
<dd><p>        The <code>ADR</code> directive will be automatically converted into
        <code>ADRL</code> if required (which inserts an additional
        <code>ADD</code>/<code>SUB</code> to calculate an address).
</p>
    </dd>
<dt> &lsquo;<samp>-opt-ldrpc</samp>&rsquo;</dt>
<dd><p>        The maximum range in which PC-relative symbols can be accessed
        through <code>LDR</code> and <code>STR</code> is extended from +/-4KB to +/-1MB
        (or +/-256 Bytes to +/-65536 Bytes when accessing half-words).
        This is done by automatically inserting an additional <code>ADD</code>
        or <code>SUB</code> instruction before the <code>LDR</code>/<code>STR</code>.
</p>
    </dd>
<dt> &lsquo;<samp>-thumb</samp>&rsquo;</dt>
<dd><p>        Start assembling in Thumb mode.
</p></dd>
</dl>


<hr size="6">
<a name="General-11"></a>
<h2 class="section">17.3 General</h2>

<p>This backend accepts ARM instructions as described in various ARM CPU
data sheets. Additionally some architectures support a second, more
dense, instruction set, called THUMB. There are special directives
to switch between those two instruction sets.
</p>
<p>The target address type is 32bit.
</p>
<p>Default alignment for instructions is 4 bytes for ARM and 2 bytes for
THUMB. Sections will be aligned to 4 bytes by default. Data is
aligned to its natural alignment by default.
</p>

<hr size="6">
<a name="Extensions-5"></a>
<h2 class="section">17.4 Extensions</h2>

<p>This backend extends the selected syntax module by the following
directives:
</p>
<dl compact="compact">
<dt> <code>.arm</code></dt>
<dd><p>      Generate 32-bit ARM code.
</p>
</dd>
<dt> <code>.thumb</code></dt>
<dd><p>      Generate 16-bit THUMB code.
</p></dd>
</dl>


<hr size="6">
<a name="Optimizations-6"></a>
<h2 class="section">17.5 Optimizations</h2>

<p>This backend performs the following optimizations and translations for
the ARM instruction set:
</p>
<ul class="toc">
<li>- <code>LDR/STR Rd,symbol</code>, with a distance between symbol and PC larger
 than 4KB, is translated to
 <code>ADD/SUB Rd,PC,#offset&amp;0xff000</code> +
 <code>LDR/STR Rd,[Rd,#offset&amp;0xfff]</code>, when allowed by the option
 <code>-opt-ldrpc</code>.

</li><li>- <code>ADR Rd,symbol</code> is translated to
 <code>ADD/SUB Rd,PC,#rotated_offset8</code>.

</li><li>- <code>ADRL Rd,symbol</code> is translated to
 <code>ADD/SUB Rd,PC,#hi_rotated8</code> + <code>ADD/SUB Rd,Rd,#lo_rotated8</code>.
 <code>ADR</code> will be automatically treated as <code>ADRL</code> when required
 and when allowed by the option <code>-opt-adr</code>.

</li><li>- The immediate operand of ALU-instructions will be translated into
 the appropriate 8-bit-rotated value. When rotation alone doesn&rsquo;t
 succeed the backed will try it with inverted and negated values
 (inverting/negating the ALU-instruction too).

</li></ul>

<p>For the THUMB instruction set the following optimizations and translations
are done:
</p>
<ul class="toc">
<li>- A conditional branch with a branch-destination being out of range is
 translated into <code>B&lt;!cc&gt; .+4</code> + <code>B label</code>.

</li><li>- The <code>BL</code> instruction is translated into two sub-instructions combining
 the high- and low 22 bit of the branch displacement.

</li></ul>


<hr size="6">
<a name="Known-Problems-8"></a>
<h2 class="section">17.6 Known Problems</h2>

<p>    Some known problems of this module at the moment:
</p>
<ul class="toc">
<li>- Only instruction sets up to ARM architecture V4t are supported.

</li></ul>

<hr size="6">
<a name="Error-Messages-11"></a>
<h2 class="section">17.7 Error Messages</h2>

<p>This module has the following error messages:
</p>
<ul class="toc">
<li>- 2001: instruction not supported on selected architecture
</li><li>- 2002: trailing garbage in operand
</li><li>- 2003: label from current section required
</li><li>- 2004: branch offset (%ld) is out of range
</li><li>- 2005: PC-relative load/store (offset %ld) out of range
</li><li>- 2006: cannot make rotated immediate from PC-relative offset (0x%lx)
</li><li>- 2007: constant integer expression required
</li><li>- 2008: constant (0x%lx) not suitable for 8-bit rotated immediate
</li><li>- 2009: branch to an unaligned address (offset %ld)
</li><li>- 2010: not a valid ARM register
</li><li>- 2011: PC (r15) not allowed in this mode
</li><li>- 2012: PC (r15) not allowed for offset register Rm
</li><li>- 2013: PC (r15) not allowed with write-back
</li><li>- 2014: register r%ld was used multiple times
</li><li>- 2015: illegal immediate shift count (%ld)
</li><li>- 2016: not a valid shift register
</li><li>- 2017: 24-bit unsigned immediate expected
</li><li>- 2018: data size %d not supported
</li><li>- 2019: illegal addressing mode: %s
</li><li>- 2020: signed/halfword ldr/str doesn&rsquo;t support shifts
</li><li>- 2021: %d-bit immediate offset out of range (%ld)
</li><li>- 2022: post-indexed addressing mode exptected
</li><li>- 2023: operation not allowed on external symbols
</li><li>- 2024: ldc/stc offset has to be a multiple of 4
</li><li>- 2025: illegal coprocessor operation mode or type: %ld\n
</li><li>- 2026: %d-bit unsigned immediate offset out of range (%ld)
</li><li>- 2027: offset has to be a multiple of %d
</li><li>- 2028: instruction at unaligned address

</li></ul>

<hr size="6">
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#ARM-cpu-module" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="vasm_17.html#g_t80x86-cpu-module" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="vasm_0.html#General-9" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="vasm_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[Index]</td>
<td valign="middle" align="left">[<a href="vasm_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<p>
 <font size="-1">
  This document was generated by <em>Luis Panadero Guardeño</em> on <em>January 13, 2015</em> using <a href="http://www.nongnu.org/texi2html/"><em>texi2html 1.82</em></a>.
 </font>
 <br>

</p>
</body>
</html>
