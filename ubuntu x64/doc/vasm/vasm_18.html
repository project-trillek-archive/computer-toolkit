<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<!-- Created on January 13, 2015 by texi2html 1.82
texi2html was written by: 
            Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people.
Send bugs and suggestions to <texi2html-bug@nongnu.org>
-->
<head>
<title>vasm manual: 19. z80 cpu module</title>

<meta name="description" content="vasm manual: 19. z80 cpu module">
<meta name="keywords" content="vasm manual: 19. z80 cpu module">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.82">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.roman {font-family:serif; font-weight:normal;}
span.sansserif {font-family:sans-serif; font-weight:normal;}
ul.toc {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="vasm_17.html#g_t80x86-cpu-module" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="vasm_19.html#g_t6800-cpu-module" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="vasm_0.html#General-9" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="vasm_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[Index]</td>
<td valign="middle" align="left">[<a href="vasm_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>

<hr size="2">
<a name="z80-cpu-module"></a>
<a name="z80-cpu-module-1"></a>
<h1 class="chapter">19. z80 cpu module</h1>
<p>This chapter documents the backend for the 8080/z80/gbz80/64180/RCMx000
microprocessor family.
</p>
<hr size="6">
<a name="Legal-9"></a>
<h2 class="section">19.1 Legal</h2>

<p>    This module is copyright in 2009 by Dominic Morris
</p>
<hr size="6">
<a name="Additional-options-for-this-module-5"></a>
<h2 class="section">19.2 Additional options for this module</h2>

<p>This module provides the following additional options:
</p>
<dl compact="compact">
<dt> &lsquo;<samp>-8080</samp>&rsquo;</dt>
<dd><p>        Turns on 8080 compatibility mode. Any use of z80 (or higher)
        opcodes will result in an error being generated.
    </p></dd>
<dt> &lsquo;<samp>-gbz80</samp>&rsquo;</dt>
<dd><p>        Turns on gbz80 compatibility mode. Any use of non-supported
        opcodes will result in an error being generated.
    </p></dd>
<dt> &lsquo;<samp>-hd64180</samp>&rsquo;</dt>
<dd><p>        Turns on 64180 mode supporting additional 64180 opcodes.
    </p></dd>
<dt> &lsquo;<samp>-rcm2000</samp>&rsquo;</dt>
<dt> &lsquo;<samp>-rcm3000</samp>&rsquo;</dt>
<dt> &lsquo;<samp>-rcm4000</samp>&rsquo;</dt>
<dd><p>         Turns on Rabbit compatibility mode, generating the correct
         codes for moved opcodes and supporting the additional Rabbit
         instructions. In this mode, 8 bit access to the 16 bit index
         registers is not permitted.
    </p></dd>
<dt> &lsquo;<samp>-rcmemu</samp>&rsquo;</dt>
<dd><p>         Turns on emulation of some instructions which aren&rsquo;t available
         on the Rabbit processors.
    </p></dd>
<dt> &lsquo;<samp>-swapixiy</samp>&rsquo;</dt>
<dd><p>        Swaps the usage of ix and iy registers. This is useful
        for compiling generic code that uses an index register that
        is reserved on the target machine.
    </p></dd>
<dt> &lsquo;<samp>-z80asm</samp>&rsquo;</dt>
<dd><p>         Switches on z80asm mode. This translates ASMPC to $ and accepts
         some pseudo opcodes that z80asm supports. Most emulation of 
         z80asm directives is provided by the oldsyntax syntax module.         
</p></dd>
</dl>

<hr size="6">
<a name="General-2"></a>
<h2 class="section">19.3 General</h2>

<p>This backend accepts z80 family instructions in standard
Zilog syntax. Rabbit opcodes are accepted as defined in the 
publically available reference material from Rabbit Semiconductor,
with the exception that the <code>ljp</code> and <code>lcall</code> opcodes need
to be supplied with a 24 bit number rather than an 8 bit <code>xpc</code> and a
16 bit address.
</p>
<p>The target address type is 16 bit.
</p>
<p>Instructions consist of one up to six bytes and require no alignment.
There is also no alignment requirement for sections and data.
</p>
<hr size="6">
<a name="Extensions-8"></a>
<h2 class="section">19.4 Extensions</h2>

<p>This backend provides the following specific extensions:
</p>
<ul class="toc">
<li>- Certain Rabbit opcodes can be prefixed by the <code>altd</code> and/or the
 <code>ioi</code>/<code>ioe</code> modifier.
 For details of which instructions these are valid for please
 see the documentation from Rabbit.

</li><li>- The parser understands a lo/hi-modifier to select low- or high-byte
 of a 16-bit word. The character <code>&lt;</code> is used to select the low-byte
 and <code>&gt;</code> for the high-byte. It has to be the first character before
 an expression.

</li><li>- When applying the operation <code>/256</code>, <code>%256</code> or <code>&amp;256</code>
 on a label, an appropriate lo/hi-byte relocation will automatically be
 generated.

</li></ul>

<hr size="6">
<a name="Optimisations"></a>
<h2 class="section">19.5 Optimisations</h2>

<p>This backend supports the emulation of certain z80 instructions on the
Rabbit/gbz80 processor. These instructions are <code>rld</code>, <code>rrd</code>,
<code>cpi</code>, <code>cpir</code>, <code>cpd</code> and <code>cpdr</code>.
The link stage should provide routines with the opcode name prefixed with
<code>rcmx_</code> (eg <code>rcmx_rld</code>) which implements the same functionality.
Example implementations are available within the z88dk CVS tree.
</p>
<p>Additionally, for the Rabbit targets the missing call <code>cc</code>, opcodes
will be emulated.
</p>
<hr size="6">
<a name="Known-Problems-4"></a>
<h2 class="section">19.6 Known Problems</h2>

<p>    Some known problems of this module at the moment:
</p>
<ul class="toc">
<li>- Not all RCM4000 opcodes are supported (<code>llcall</code>, <code>lljp</code>
 are not available).

</li></ul>

<hr size="6">
<a name="Error-Messages-9"></a>
<h2 class="section">19.7 Error Messages</h2>

<p>This module has the following error messages:
</p>
<ul class="toc">
<li>- 2001: index offset out of bounds (%d)
</li><li>- 2002: Opcode not supported by %s (%s)
</li><li>- 2003: Index registers not available on 8080
</li><li>- 2004: out of range for 8 bit expression (%d)
</li><li>- 2005: invalid bit number (%d) should be in range 0..7
</li><li>- 2006: rst value out of range (%d/0x%02x)  
</li><li>- 2007: %s value out of range (%d)
</li><li>- 2008: index offset should be a constant
</li><li>- 2009: invalid branch type for jr
</li><li>- 2010: Rabbit target doesn&rsquo;t support rst %d
</li><li>- 2011: Rabbit target doesn&rsquo;t support 8 bit index registers 
</li><li>- 2012: z180 target doesn&rsquo;t support 8 bit index registers
</li><li>- 2013: invalid branch type for jre
</li><li>- 2014: Opcode not supported by %s (%s) but it can be emulated (-rcmemu)
</li><li>- 2015: %s specifier is only valid for Rabbit processors
</li><li>- 2016: Only one of ioi and ioe can be specified at a time
</li><li>- 2017: %s specifier is not valid for the opcode %s
</li><li>- 2018: %s specifier redundant for the opcode %s
</li><li>- 2019: %s specifier has no effect on the opcode %s
</li><li>- 2020: Operand value must evaluate to a constant for opcode %s
</li><li>- 2021: Unhandled operand type wanted 0x%x got 0x%x
</li><li>- 2022: Missed matched index registers on %s
</li><li>- 2023: Only out (c),0 is supported for the opcode %s
</li><li>- 2024: Operations between different index registers are forbidden
</li><li>- 2025: Operations between ix/iy/hl are forbidden
</li><li>- 2026: Double indirection forbidden
</li></ul>

<hr size="6">
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#z80-cpu-module" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="vasm_19.html#g_t6800-cpu-module" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="vasm_0.html#General-9" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="vasm_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[Index]</td>
<td valign="middle" align="left">[<a href="vasm_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<p>
 <font size="-1">
  This document was generated by <em>Luis Panadero Guarde√±o</em> on <em>January 13, 2015</em> using <a href="http://www.nongnu.org/texi2html/"><em>texi2html 1.82</em></a>.
 </font>
 <br>

</p>
</body>
</html>
